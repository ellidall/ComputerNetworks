### Демонстрация работы приложения в директории **[screenshots](./screenshots)**

### Демонстрация работы приложения в директории **[screenshots](./screenshots)**

# Документация по итеративному DNS-резолверу на C++

## Обзор

Это приложение — **полностью самостоятельный итеративный DNS-резолвер**, написанный на **C++20**, который выполняет разрешение доменных имён **без использования системного рекурсивного резолвера**. Разрешение начинается с **корневых DNS-серверов** и следует по цепочке рефералов до получения финального IP-адреса.

Реализация строго соответствует требованиям учебного задания:
- Используется **только итеративный режим** (`RD=0`),
- Все сетевые операции выполняются через **POSIX-сокеты** (`socket`, `sendto`, `recvfrom`, `close`),
- **Никакие системные функции разрешения имён (включая `getaddrinfo`, `gethostbyname` и др.) не используются**,
- Поддерживается разрешение записей типов **A (IPv4)** и **AAAA (IPv6)**,
- Реализована обработка **glue-записей** из раздела **Additional Section** DNS-ответа,
- Поддерживается **DNS-компрессия имён** и корректный парсинг пакетов в соответствии с **RFC 1035**.

## Архитектура

Приложение состоит из следующих ключевых компонентов:

### 1. **Формирование DNS-запроса**
Функция `BuildDnsQuery` создаёт DNS-пакет в бинарном виде:
- Фиксированный ID (`0x1234`),
- Флаги: `QR=0`, `RD=0` (итеративный запрос),
- Один вопрос (`QDCOUNT = 1`),
- Тип записи: `A` (1) или `AAAA` (28),
- Класс: `IN` (1),
- Имя домена кодируется согласно стандарту (метки с длиной, завершается нулём).

### 2. **Разбор DNS-ответа**
- `DecodeDnsName` — рекурсивно декодирует доменные имена с учётом **указателей сжатия** (`0xC0XX`),
- `ParseDnsResponse` — проверяет ID, флаг `QR`, код ответа (`RCODE`), и извлекает требуемые ресурсные записи из **Answer Section**,
- `ExtractNameservers` — извлекает имена DNS-серверов из **Authority Section** при отсутствии прямого ответа,
- `ExtractGlueRecords` — парсит **Additional Section** и извлекает A-записи (glue), соответствующие именам из Authority Section.

### 3. **Итеративное разрешение**
- `PerformIterativeLookup` — реализует основной цикл разрешения:
  1. Начинает с **списка корневых серверов**,
  2. Опрашивает серверы текущего уровня,
  3. При получении реферала (NS-записей):
    - Сначала пытается использовать **glue-записи** из Additional Section,
    - Если glue нет — **рекурсивно разрешает имя NS-сервера** тем же резолвером (с ограничением глубины),
  4. Переходит к следующему уровню (корень → TLD → authoritative),
  5. Ограничение глубины — **3 уровня вложенности**, ограничение хопов — **5 итераций**.

### 4. **Сетевой уровень**
- `SendDnsQuery` использует **UDP-сокет** (`SOCK_DGRAM`) на порту **53**,
- Таймаут ожидания ответа — **5 секунд**,
- Все сокеты **гарантированно закрываются** после использования.

### 5. **Режим отладки**
- При запуске с флагом `-d` выводятся:
  - Все шаги перехода по уровням DNS-иерархии,
  - Использование glue-записей или попытки разрешения NS,
  - IP-адреса опрашиваемых серверов,
  - Финальный ответ.

## Поддерживаемые типы записей

| Тип   | Значение | Описание              |
|-------|----------|-----------------------|
| `A`   | 1        | IPv4-адрес (32 бита)  |
| `AAAA`| 28       | IPv6-адрес (128 бит)  |

Запросы других типов отклоняются с сообщением об ошибке.

## Используемые DNS-серверы

- **Корневые серверы** заданы статически в соответствии с официальным списком IANA:
  ```text
  198.41.0.4      // a.root-servers.net
  199.9.14.201    // b.root-servers.net
  192.33.4.12     // c.root-servers.net
  199.7.91.13     // d.root-servers.net
  192.203.230.10  // e.root-servers.net
  192.5.5.241     // f.root-servers.net
  192.112.36.4    // g.root-servers.net
  198.97.190.53   // h.root-servers.net
  192.36.148.17   // i.root-servers.net
  192.58.128.30   // j.root-servers.net
  193.0.14.129    // k.root-servers.net
  199.7.83.42     // l.root-servers.net
  202.12.27.33    // m.root-servers.net