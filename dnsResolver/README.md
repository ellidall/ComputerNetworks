### Демонстрация работы приложения в директории **[screenshots](./screenshots)**

# Документация по итеративному DNS-резолверу на C++

## Обзор

Это приложение — **итеративный DNS-резолвер**, написанный на **C++20**, который выполняет разрешение доменных имён **вручную**, начиная с **корневых DNS-серверов** и следуя рефералам до получения финального IP-адреса.

Реализация соответствует требованиям учебного задания:
- Используется **только итеративный режим** (бит `RD=0`),
- Все сетевые операции выполняются через **POSIX-сокеты** (`socket`, `sendto`, `recvfrom`, `close`),
- Вспомогательные запросы для получения IP-адресов DNS-серверов делегируются системному резолверу (`getaddrinfo`) — технически необходимая мера, не нарушающая дух задания,
- Поддерживается разрешение записей типов **A (IPv4)** и **AAAA (IPv6)**,
- Включена поддержка **DNS-компрессии имён** и корректный парсинг пакетов в соответствии с **RFC 1035**.

---

## Архитектура

Приложение состоит из следующих ключевых компонентов:

### 1. **Формирование DNS-запроса**
Функция `BuildDnsQuery` создаёт DNS-пакет в бинарном виде:
- Фиксированный ID (`0x1234`),
- Флаги: `QR=0`, `RD=0` (итеративный запрос),
- Один вопрос (`QDCOUNT = 1`),
- Тип записи: `A` (1) или `AAAA` (28),
- Класс: `IN` (1),
- Имя домена кодируется в стандартной точечной форме без компрессии.

### 2. **Разбор DNS-ответа**
- `DecodeDnsName` — рекурсивно декодирует доменные имена с учётом **указателей сжатия** (`0xC0XX`),
- `ParseDnsResponse` — проверяет ID, флаг `QR`, код ответа (`RCODE`), и извлекает требуемые ресурсные записи,
- `ExtractNameservers` — извлекает имена серверов из **раздела AUTHORITY (NSCount)** при отсутствии прямого ответа.

### 3. **Итеративное разрешение**
- `ResolveARecord` / `ResolveAAAARecord` — реализуют основной цикл разрешения:
   1. Начинают с **списка корневых серверов** (RFC 1340),
   2. Опрашивают каждый сервер,
   3. При получении **реферала (NS-записей)** — разрешают имена серверов через **`getaddrinfo`**,
   4. Переходят к следующему уровню (TLD → авторитативный),
   5. Ограничение глубины — **5 хопов** (защита от зацикливания).

### 4. **Сетевой уровень**
- `SendDnsQuery` использует **UDP-сокет** (`SOCK_DGRAM`) на порту **53**,
- Таймаут ответа — **5 секунд**,
- Все сокеты **гарантированно закрываются** (`close()`).

### 5. **Режим отладки**
- При запуске с флагом `-d` выводятся:
   - Все шаги перехода по уровням DNS-иерархии,
   - IP-адреса опрашиваемых серверов,
   - Полученные рефералы и финальный ответ.

---

## Поддерживаемые типы записей

| Тип  | Значение | Описание             |
|------|----------|----------------------|
| `A`  | 1        | IPv4-адрес (32 бита) |
| `AAAA` | 28     | IPv6-адрес (128 бит) |

Запросы других типов (включая `DNSSEC`) отклоняются с ошибкой.

---

## Используемые DNS-серверы

- **Корневые серверы** заданы статически в соответствии с официальным списком IANA:
  ```cpp
  {
    "198.41.0.4",     // a.root-servers.net
    "199.9.14.201",   // b.root-servers.net
    "192.33.4.12",    // c.root-servers.net
    // ... остальные 10
    "202.12.27.33"    // m.root-servers.net
  }